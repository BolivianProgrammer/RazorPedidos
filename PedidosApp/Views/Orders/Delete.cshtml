@model PedidosApp.Models.Order
@using System.ComponentModel.DataAnnotations

@{
    ViewData["Title"] = "Eliminar Pedido";
}

<h1>Eliminar Pedido #@Model.Id</h1>

<div class="alert alert-danger">
    <h3>¿Está seguro de que desea eliminar este pedido?</h3>
</div>

<div class="row">
    <div class="col-md-6">
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">Información del Pedido</h5>
            </div>
            <div class="card-body">
                <dl class="row">
                    <dt class="col-sm-4">Cliente</dt>
                    <dd class="col-sm-8">@Model.User.Name</dd>
                    
                    <dt class="col-sm-4">Correo</dt>
                    <dd class="col-sm-8">@Model.User.Email</dd>
                    
                    <dt class="col-sm-4">Fecha</dt>
                    <dd class="col-sm-8">@Model.OrderDate.ToString("dd/MM/yyyy HH:mm")</dd>
                    
                    <dt class="col-sm-4">Estado</dt>
                    <dd class="col-sm-8">
                        <span class="badge @GetStatusBadgeClass(Model.Status)">
                            @GetStatusDisplayName(Model.Status)
                        </span>
                    </dd>
                    
                    <dt class="col-sm-4">Total</dt>
                    <dd class="col-sm-8">@Model.Total.ToString("C2")</dd>
                </dl>
                
                @if (Model.Status == OrderStatus.Pending || Model.Status == OrderStatus.Processing)
                {
                    <div class="alert alert-info mt-3">
                        <i class="bi bi-info-circle"></i>
                        Al eliminar este pedido, los productos se devolverán al inventario.
                    </div>
                }
            </div>
        </div>
    </div>

    <div class="col-md-6">
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">Resumen de Productos</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Producto</th>
                                <th>Precio</th>
                                <th>Cant.</th>
                                <th>Subtotal</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model.OrderItems)
                            {
                                <tr>
                                    <td>@item.Product.Name</td>
                                    <td>@item.Product.Price.ToString("C2")</td>
                                    <td>@item.Quantity</td>
                                    <td>@item.Subtotal.ToString("C2")</td>
                                </tr>
                            }
                        </tbody>
                        <tfoot>
                            <tr>
                                <th colspan="3" class="text-end">Total:</th>
                                <th>@Model.Total.ToString("C2")</th>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<form asp-action="Delete">
    <input type="hidden" asp-for="Id" />
    <button type="submit" class="btn btn-danger">Confirmar Eliminación</button>
    <a asp-action="Index" class="btn btn-secondary">Volver a la Lista</a>
</form>

@functions {
    private string GetStatusDisplayName(OrderStatus status)
    {
        var memberInfo = status.GetType().GetMember(status.ToString());
        var attributes = memberInfo[0].GetCustomAttributes(typeof(DisplayAttribute), false);
        
        return attributes.Length > 0
            ? ((DisplayAttribute)attributes[0]).Name
            : status.ToString();
    }
    
    private string GetStatusBadgeClass(OrderStatus status)
    {
        return status switch
        {
            OrderStatus.Pending => "bg-warning",
            OrderStatus.Processing => "bg-info",
            OrderStatus.Completed => "bg-success",
            OrderStatus.Cancelled => "bg-danger",
            _ => "bg-secondary"
        };
    }
}